{% extends 'benchmark/index.html.twig' %}

{% set mainPath = 'product' %}
{% set title = title|default('title.products')|trans %}
	
{% block content %}
	<div class="container-fluid">
		<div class="col-sm-2">
			{% block sidebar %}
				<div class="col-xs-12">
					<h3>{{ category.name }} {{ category.subname }}</h3>
				</div>
				
				{% block categoryFilterForm %}
					{% form_theme categoryFilter 'form/fields.html.twig' %}
					
					{{ form_start(categoryFilter) }}
						<div class="col-xs-12">
							{{ form_row(categoryFilter.category, { label: 'label.benchmark.category' }) }}
						</div>
						<div class="col-xs-12">
								{{ form_row(categoryFilter.submit, { 'icon': 'fa-check', 'label': 'action.submit', 'attr': {'class': 'btn btn-success'} }) }}
						</div>		
					{{ form_end(categoryFilter) }}
					
					{% form_theme subcategoryFilter 'form/fields.html.twig' %}
					
					{{ form_start(subcategoryFilter) }}
						<div class="col-xs-12">
							{{ form_row(subcategoryFilter.subcategory, { label: 'label.benchmark.subcategory' }) }}
						</div>
						<div class="col-xs-12">
							{{ form_row(subcategoryFilter.submit, { 'icon': 'fa-check', 'label': 'action.submit', 'attr': {'class': 'btn btn-success'} }) }}
						</div>	
					{{ form_end(subcategoryFilter) }}
					
					{% form_theme filter 'form/fields.html.twig' %}
					
					{{ form_start(filter) }}
						{% set hidden = filter.categories.vars.choices|length > 0 ? '' : 'hidden' %}
						<div class="col-xs-12 {{ hidden }}">
							{{ form_row(filter.categories, { label: 'label.benchmark.categories' }) }}
						</div>
						
						{% set hidden = filter.brands.vars.choices|length > 0 ? '' : 'hidden' %}
						<div class="col-xs-12 {{ hidden }}">
							{{ form_row(filter.brands, { label: 'label.benchmark.brands' }) }}
						</div>
						
						<div class="col-xs-12 {{ hidden }}">
							{{ form_row(filter.name, { label: 'label.benchmark.product.name' }) }}
						</div>
						
						<div class="col-xs-6">
							{{ form_row(filter.minPrice, { label: 'label.benchmark.product.minPrice' }) }}
						</div>
						<div class="col-xs-6">
							{{ form_row(filter.maxPrice, { label: 'label.benchmark.product.maxPrice' }) }}
						</div>
						
						{% for field in entryFilter.filterFields %}
								{% if field.filterType == constant('AppBundle\\Entity\\BenchmarkField::DECIMAL_FILTER_TYPE') %}
									<div class="col-xs-6">
										{{ form_row(filter[field.filterName|clean ~ '_min'], { label: field.filterName ~ ' (min)' }) }}
									</div>
									<div class="col-xs-6">
										{{ form_row(filter[field.filterName|clean ~ '_max'], { label: field.filterName ~ ' (max)' }) }}
									</div>
								{% elseif field.filterType == constant('AppBundle\\Entity\\BenchmarkField::INTEGER_FILTER_TYPE') %}
									<div class="col-xs-6">
										{{ form_row(filter[field.filterName|clean ~ '_min'], { label: field.filterName ~ ' (min)' }) }}
									</div>
									<div class="col-xs-6">
										{{ form_row(filter[field.filterName|clean ~ '_max'], { label: field.filterName ~ ' (max)' }) }}
									</div>
								{% else %}
									<div class="col-xs-12">
										{{ form_row(filter[field.filterName|clean], { label: field.filterName }) }}
									</div>
								{% endif %}
						{% endfor %}
						
						<div class="col-xs-12 padding-5">
							<div class="btn-group">
								{{ form_widget(filter.search, { 'icon': 'fa-search', 'label': 'action.search', 'attr': {'class': 'btn btn-primary'} }) }}
								{{ form_widget(filter.clear, { 'icon': 'fa-eraser', 'label': 'action.clear', 'attr': {'class': 'btn btn-warning'} }) }}
							</div>
						</div>
						<div class="col-xs-12 padding-5">
							{{ form_widget(filter.saveQuery, { 'icon': 'fa-save', 'label': 'action.saveQuery', 'attr': {'class': 'btn btn-success'} }) }}
						</div>
						<div class="col-xs-12 padding-5">
							{{ form_widget(filter.saveResults, { 'icon': 'fa-save', 'label': 'action.saveResults', 'attr': {'class': 'btn btn-success'} }) }}
						</div>
						
					{{ form_end(filter) }}
				{% endblock %}
				
				<div>&nbsp;</div>
				
				{% block actions %}
					<div class="row padding-5">
						<div class="col-xs-12 padding-5">
							<a class="btn btn-primary" href="{{ path(basePath ~ mainPath ~ '_export_to_csv', routeParams) }}">
								<span class="fa fa-download"></span> {{ 'action.benchmark.export.csv'|trans }}
							</a>
						</div>
					</div>
					<div class="row padding-5">
						<div class="col-xs-12 padding-5">
							<a class="btn btn-primary" href="{{ path(basePath ~ mainPath ~ '_export_to_excel', routeParams) }}">
								<span class="fa fa-download"></span> {{ 'action.benchmark.export.excel'|trans }}
							</a>
						</div>
					</div>
					<div class="row padding-5">
						<div class="col-xs-12 padding-5">
							<a class="btn btn-primary" href="{{ path(basePath ~ mainPath ~ '_export_to_html', routeParams) }}">
								<span class="fa fa-download"></span> {{ 'action.benchmark.export.html'|trans }}
							</a>
						</div>
					</div>
				{% endblock %}
			{% endblock %}
		</div>
		<div class="col-sm-10">
			{% block tableContent %}
				{% set restWidth = 90 - entries|length * 15 %}
				<table class="table table-striped vert-align">
					<tr>
						<th width="10%" class="text-right">{{ 'label.category'|trans }}</th>
						{% for entry in entries %}
							<td width="15%" class="text-center">
								{% if filter.categories.vars.choices|length > 0 %}
									{{ entry.categoryName }}&nbsp;{{ entry.categorySubname }}
								{% endif %}
							</td>
						{% endfor %}
						<td width="{{ restWidth }}%"></td>
					</tr>
					<tr>
						<th></th>
						{% for entry in entries %}
							<td>
								<div class="rect">
									<div class="div-center">
										<img class="img-responsive" alt="{{ entry.name }}" src="{{ asset(entry.image) }}" />
									</div>
								</div>
							</td>
						{% endfor %}
						<td></td>
					</tr>
					<tr>
						<th class="text-right">{{ 'label.brand'|trans }}</th>
						{% for entry in entries %}
							<td class="text-center">{{ entry.brandName }}</td>
						{% endfor %}
						<td></td>
					</tr>
					<tr>
						<th class="text-right">{{ 'label.benchmark.product.name'|trans }}</th>
						{% for entry in entries %}
							<td class="text-center">{{ entry.name }}</td>
						{% endfor %}
						<td></td>
					</tr>
					<tr>
						<th class="text-right">{{ 'label.benchmark.product.price'|trans }}</th>
						{% for entry in entries %}
							<td class="text-center">{{ entry.price|number_format(2, '.', ' ') }}</td>
						{% endfor %}
						<td></td>
					</tr>
					
					{% for field in entryFilter.showFields %}
						{% set key = benchmarkFieldValueTypeDBName(field.valueType) ~ field.valueNumber %}
						{% set show = false %}
						{% for entry in entries if show == false %}
							{% if entry[key] %}
								{% set show = true %}
							{% endif %}
						{% endfor %}
						{% if show %}
							<tr>
								<th class="text-right">{{ field.fieldName }}</th>
								{% for entry in entries %}
									<td class="text-center">
										{% if field.fieldType == constant('AppBundle\\Entity\\BenchmarkField::BOOLEAN_FIELD_TYPE') %}
									        {{ entry[key] ? '+' : '-' }}
										{% elseif field.fieldType == constant('AppBundle\\Entity\\BenchmarkField::DECIMAL_FIELD_TYPE') %}
											{{ entry[key] ? entry[key]|number_format(field.decimalPlaces, '.', ' ') : '' }}
								        {% else %}
									        {{ entry[key] }}
										{% endif%}
									</td>
								{% endfor %}
								<td></td>
							</tr>		
						{% endif %}					
					{% endfor %}
					
					<tr>
						<th class="text-right">{{ 'label.actions'|trans }}</th>
						{% for entry in entries %}
							<td class="text-center">
								<a class="btn btn-primary" href="{{ path(basePath ~ mainPath ~ '_show', { id: entry.id }) }}" data-toggle="tooltip" title="{{ 'action.show'|trans }}">
									<span class="fa fa-eye"></span>
								</a>
								<a class="btn btn-warning" href="{{ path(basePath ~ mainPath ~ '_compare', { id: entry.id }) }}" data-toggle="tooltip" title="{{ 'action.compare'|trans }}">
									<span class="fa fa-balance-scale"></span>
								</a>
								{% if entry.benchmarkMessage %}
									{% set messagePath = basePath ~ 'benchmark_message_show' %}
									{% set messageParams = { id: entry.benchmarkMessage.id } %}
								{% else %}
									{% set messagePath = basePath ~ 'benchmark_message_new' %}
									{% set messageParams = { product: entry.id } %}
								{% endif %}
								<a class="btn btn-danger" href="{{ path(messagePath, messageParams) }}" data-toggle="tooltip" title="{{ 'action.reportError'|trans }}">
									<span class="fa fa-exclamation-circle"></span>
								</a>
							</td>
						{% endfor %}
						<td></td>
					</tr>
					
				</table>
			{% endblock %}
			
			{% block tablePaginator %}
				<div>
			        {{ knp_pagination_render(entries) }}
			    </div>
		    {% endblock %}
		</div>	
	</div>
{% endblock %}
